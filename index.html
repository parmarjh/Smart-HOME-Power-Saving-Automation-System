<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial=" 1.0">
    <title>Smart Power Saving Automation System - Enhanced Tracking</title>
    <meta name="description"
        content="AI-powered electric power saving with real-time person tracking, appliance monitoring, and comprehensive usage analytics">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="tracking.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
</head>

<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <div class="logo">
                    <svg class="logo-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M13 2L3 14h8l-1 8 10-12h-8l1-8z" fill="currentColor" />
                    </svg>
                    <h1>Smart Power Control</h1>
                </div>
            </div>
            <div class="header-right">
                <div class="power-status">
                    <span class="status-label">System Status:</span>
                    <span class="status-indicator active" id="systemStatus">Active</span>
                </div>
                <div class="user-profile">
                    <div class="user-icon">üë§</div>
                    <div class="user-info">
                        <span class="user-name" id="userName">Loading...</span>
                        <span class="user-email" id="userEmail">user@email.com</span>
                    </div>
                    <button class="btn-logout" id="logoutBtn" title="Logout">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4M16 17l5-5-5-5M21 12H9"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                    </button>
                </div>
                <div class="savings-badge">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" />
                    </svg>
                    <span id="totalSavings">0</span>% Saved
                </div>
            </div>
        </header>

        <!-- Main Grid -->
        <div class="main-grid">
            <!-- Left Panel: Camera & Detection -->
            <div class="panel camera-panel">
                <div class="panel-header">
                    <h2>
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M23 7l-7 5 7 5V7z" fill="currentColor" />
                            <rect x="1" y="5" width="15" height="14" rx="2" fill="currentColor" opacity="0.3" />
                        </svg>
                        Live Camera Feed
                    </h2>
                    <button class="btn-icon" id="toggleCamera" aria-label="Toggle camera">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
                            <circle cx="12" cy="12" r="3" fill="currentColor" />
                        </svg>
                    </button>
                </div>

                <div class="camera-container">
                    <video id="videoFeed" autoplay playsinline></video>
                    <canvas id="detectionCanvas"></canvas>
                    <div class="camera-overlay">
                        <div class="detection-info">
                            <div class="detection-badge" id="detectionBadge">
                                <span class="badge-icon">üë§</span>
                                <span id="personCount">0</span> Person(s)
                            </div>
                            <div class="face-badge" id="faceBadge">
                                <span class="badge-icon">üé≠</span>
                                <span id="recognizedFace">Unknown</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="camera-controls">
                    <button class="btn btn-primary" id="startCamera">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
                            <polygon points="10,8 16,12 10,16" fill="currentColor" />
                        </svg>
                        Start Camera
                    </button>
                    <button class="btn btn-secondary" id="capturePhoto">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="3" y="5" width="18" height="14" rx="2" stroke="currentColor" stroke-width="2" />
                            <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" />
                        </svg>
                        Capture Face
                    </button>
                    <button class="btn btn-secondary" id="uploadFace">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                        Upload Face
                    </button>
                    <input type="file" id="faceUpload" accept="image/*" style="display: none;">
                </div>
            </div>

            <!-- Right Panel: Light Controls & Stats -->
            <div class="right-panel">
                <!-- Light Controls -->
                <div class="panel lights-panel">
                    <div class="panel-header">
                        <h2>
                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M9 2h6l1 7H8l1-7zM8 9h8a4 4 0 0 1-8 0z" fill="currentColor" opacity="0.3" />
                                <path d="M10 18h4v4h-4v-4z" fill="currentColor" />
                            </svg>
                            Smart Devices
                        </h2>
                        <div class="mode-toggle">
                            <button class="mode-btn active" data-mode="auto">Auto</button>
                            <button class="mode-btn" data-mode="manual">Manual</button>
                        </div>
                    </div>

                    <div class="lights-grid" id="lightsGrid">
                        <!-- Light cards will be dynamically generated -->
                    </div>
                </div>

                <!-- Statistics Panel -->
                <div class="panel stats-panel">
                    <div class="panel-header">
                        <h2>
                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M3 3v18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                                <path d="M7 16l3-4 4 2 6-7" stroke="currentColor" stroke-width="2"
                                    stroke-linecap="round" />
                            </svg>
                            Power Analytics
                        </h2>
                        <select id="timeRange" class="time-selector">
                            <option value="today">Today</option>
                            <option value="week">This Week</option>
                            <option value="month">This Month</option>
                        </select>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon energy">‚ö°</div>
                            <div class="stat-details">
                                <span class="stat-label">Energy Consumed</span>
                                <span class="stat-value" id="energyConsumed">0.0 kWh</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon saved">üí∞</div>
                            <div class="stat-details">
                                <span class="stat-label">Money Saved</span>
                                <span class="stat-value" id="moneySaved">‚Çπ0.00</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon time">‚è±Ô∏è</div>
                            <div class="stat-details">
                                <span class="stat-label">Avg. Response Time</span>
                                <span class="stat-value" id="responseTime">0.0s</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon detection">üéØ</div>
                            <div class="stat-details">
                                <span class="stat-label">Detections Today</span>
                                <span class="stat-value" id="detectionsCount">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Usage Tracking Dashboard (NEW!) -->
        <div class="panel tracking-panel">
            <div class="panel-header">
                <h2>
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                    </svg>
                    Device Usage Tracking
                </h2>
                <div class="tracking-stats">
                    <span class="mini-stat">üìä Person Tracking ‚Ä¢ Date/Time ‚Ä¢ Usage Count</span>
                </div>
            </div>
            <div id="usageTracking" class="tracking-container">
                <!-- Tracking content will be dynamically generated by renderUsageTracking() -->
                <div class="empty-state">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"
                            stroke="currentColor" stroke-width="2" opacity="0.3" />
                    </svg>
                    <p>Start using devices to see tracking data</p>
                </div>
            </div>
        </div>

        <!-- Bottom Panel: Activity Log & Registered Faces -->
        <div class="bottom-grid">
            <!-- Activity Log -->
            <div class="panel activity-panel">
                <div class="panel-header">
                    <h2>
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 8v4l3 3m6-3a9 9 0 1 1-18 0 9 9 0 0 1 18 0z" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" />
                        </svg>
                        Activity Log
                    </h2>
                    <button class="btn-text" id="clearLog">Clear All</button>
                </div>
                <div class="activity-list" id="activityLog">
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" opacity="0.3" />
                            <path d="M12 6v6l4 2" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                        <p>No activity yet</p>
                    </div>
                </div>
            </div>

            <!-- Registered Faces -->
            <div class="panel faces-panel">
                <div class="panel-header">
                    <h2>
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12" cy="8" r="4" stroke="currentColor" stroke-width="2" />
                            <path d="M6 21v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" />
                        </svg>
                        Registered Faces
                    </h2>
                    <span class="badge" id="facesCount">0</span>
                </div>
                <div class="faces-grid" id="facesGrid">
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12" cy="8" r="4" stroke="currentColor" stroke-width="2" opacity="0.3" />
                            <path d="M6 21v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" opacity="0.3" />
                        </svg>
                        <p>No faces registered</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Face Registration Modal -->
    <div class="modal" id="faceModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Register New Face</h3>
                <button class="modal-close" id="closeModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="face-preview">
                    <img id="facePreview" alt="Face preview">
                </div>
                <div class="form-group">
                    <label for="faceName">Name</label>
                    <input type="text" id="faceName" placeholder="Enter person's name" autocomplete="off">
                </div>
                <div class="form-group">
                    <label for="faceRole">Role (Optional)</label>
                    <input type="text" id="faceRole" placeholder="e.g., Family, Guest, etc." autocomplete="off">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelFace">Cancel</button>
                <button class="btn btn-primary" id="saveFace">Save Face</button>
            </div>
        </div>
    </div>

    <!-- Load TensorFlow.js and Face Detection Models -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.11.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.3"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/blazeface@0.0.7"></script>
    <script src="app.js"></script>
</body>

</html>